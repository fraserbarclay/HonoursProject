<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>
    <script>

        var socket = io.connect('http://localhost:8000/');

        socket.on('bodyFrame', interpretData);

        //Compensate for 'head' joint being in centre of head
        var heightAdjust = 0.1;

        function interpretData(bodyFrame) {
            var clipPlane = bodyFrame.floorClipPlane;
            var height2 = clipPlane.w
            document.getElementById("clipPlaneW").innerHTML = "clipPlaneW: " + height2;

            var user = null;
            for (i = 0; i<6; i++){
                if (bodyFrame.bodies[i].tracked == true){
                    user = bodyFrame.bodies[i];
                }
                else {
                    console.log(bodyFrame.bodies[i].tracked);
                }
            }
            
            if (user != null){
                var head = user.joints[3];

                var leftFoot = user.joints[15];
                var rightFoot = user.joints[19];

                var footX = (leftFoot.cameraX + rightFoot.cameraX)/2;
                var footY = (leftFoot.cameraY + rightFoot.cameraY)/2;
                var footZ = (leftFoot.cameraZ + rightFoot.cameraZ)/2;

                var height = (Math.sqrt(Math.pow(head.cameraX - footX, 2) +
                                        Math.pow(head.cameraY - footY, 2) +
                                        Math.pow(head.cameraZ - footZ, 2)) +
                                        heightAdjust).toFixed(2);

                document.getElementById("height").innerHTML = "Height: " + height;
                arctangent(clipPlane, head, rightFoot)
            }
        }

        function arctangent(clipPlane, head, foot){
                var cameraAngleRadians= Math.atan(clipPlane.z / clipPlane.y); 
                var cosCameraAngle = Math.cos(cameraAngleRadians);
                var sinCameraAngle = Math.sin(cameraAngleRadians);

                var footY = foot.cameraY * cosCameraAngle + foot.cameraZ * sinCameraAngle;
                var headY = head.cameraY * cosCameraAngle + head.cameraZ * sinCameraAngle;
                var height = headY - footY;
                document.getElementById("arctangent").innerHTML = "Arctangent: " + height;
        }

</script>
</head>
<body>
    <h1 id="height" style="font-size: 72px"></h1>
    <h1 id="clipPlaneW"></h1>
    <h1 id="arctangent"></h1>
</body>
</html>